{% extends "base.html" %}
{% block content %}
<h2>Defender Login</h2>

<div class="card">
  {% if not admin_scope %}
    <form method="post" style="display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end;">
      <div>
        <label for="defense">Defense</label><br>
        <select id="defense" name="defense" required>
          <option value="">Choose…</option>
          <option value="wires">Wires</option>
          <option value="keypad">Keypad</option>
          <option value="firewall">Firewall</option>
        </select>
      </div>
      <div>
        <label for="def_pass">Password</label><br>
        <input id="def_pass" name="def_pass" type="password" placeholder="••••••" required />
      </div>
      <button type="submit" name="action" value="choose">Submit</button>
    </form>
  {% else %}
    <p><strong>Managing:</strong> {{ admin_scope|capitalize }}</p>

    <form method="post" style="display:flex; gap:8px; flex-wrap:wrap;">
      <button type="submit" name="action" value="logs">View Defense Logs</button>

      {# "Increase Defense" replaces old Download action. Disabled when unavailable. #}
      <button type="submit" name="action" value="download"
              {% if not can_increase_defense %}disabled{% endif %}>
        Increase Defense
      </button>

      <button type="submit" name="action" value="logout">Logout</button>
      <button type="submit" name="action" value="cancel_detection">Cancel Detection</button>
    </form>

    {% if stats %}
      <div class="card" style="margin-top:10px;">
        <strong>Logs:</strong> Success {{ stats.success }} | Fail {{ stats.fail }}
      </div>
    {% endif %}
  {% endif %}
</div>

{% if result %}
  <div class="{{ 'success' if result.ok else 'fail' }}" style="margin-top:12px;">
    {{ result.msg }}
  </div>
{% endif %}
{% endblock %}