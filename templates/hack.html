{% extends "base.html" %}
{% block content %}
<h2>Hack Console</h2>

<!-- Credits & status -->
<div class="card" style="margin-bottom:10px; text-align:left;">
  <p><strong>Credits:</strong> {{ state.credits }}</p>
  <p><strong>Detection:</strong> {{ state.detection }}/{{ state.max_detection }}
    {% if state.detection >= state.max_detection %}
      <span style="color:red; font-weight:bold; margin-left:8px;">⚠ MAXIMUM DETECTION ⚠</span>
    {% endif %}
  </p>
  <p><strong>Files Stolen:</strong> {{ state.files }}GB</p>
</div>

<!-- Show the current puzzle type and prompt (matches training) -->
{% if puzzle %}
  <p><strong>Challenge:</strong> {{ puzzle.system|capitalize }}</p>
  <p><em>{{ puzzle.desc }}</em></p>
{% else %}
  <p><em>Press start to hack.</em></p>
{% endif %}

<form method="post" style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
  {% if not puzzle %}
    <button type="submit" name="action" value="new">Start Hack</button>
  {% else %}
    <input type="text" name="answer" placeholder="Your command / code" />
    <button type="submit" name="action" value="submit">Submit</button>
    <button type="submit" name="action" value="cancel" title="Adds 1 detection">Cancel Hack</button>

    <!-- Credits actions while a hack is active -->
    <button type="submit" name="action" value="reroll" title="1 credit">Reroll (1)</button>
  {% endif %}

  <!-- Credits action that doesn't require an active hack -->
  <button type="submit" name="action" value="cooldown" title="5 credits">Cool Down (5)</button>
</form>

{% if result %}
  <div style="margin-top:12px;">
    {% if result.neutral %}
      <span>{{ result.msg|safe }}</span>
    {% else %}
      <span class="{{ 'success' if result.ok else 'fail' }}">{{ result.msg|safe }}</span>
    {% endif %}
    {% if result.bad %}
      <span class="fail">{{ result.bad }}</span>
    {% endif %}
  </div>
{% endif %}

{% if result and files and total %}
  <div class="card" style="margin-top:10px; text-align:left;">
    <div><strong>Downloaded (on success):</strong></div>
    <ul>
      {% for name, sz in files %}
        <li>{{ name }} ({{ sz }}GB)</li>
      {% endfor %}
    </ul>
    <div><strong>Total:</strong> {{ total }}GB</div>
  </div>
{% endif %}

<a href="{{ url_for('index') }}"><button>Back</button></a>
{% endblock %}
